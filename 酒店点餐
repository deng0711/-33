#include<iostream>
#include<string>
#include<fstream>
using namespace std;

class Food
{
protected:
	string name;
	double price;
	int num;
public:
	virtual double get_sum()
	{
		double sum = price * num;
		return sum;
	}
	virtual void set_name(string name)
	{
		this->name = name;
	}
	virtual string get_name()
	{
		return name;
	}
	virtual void set_price(double price)
	{
		this->price = price;
	}
	virtual double get_price()
	{
		return price;
	}
	virtual void set_num(int num)
	{
		this->num = num;
	}
	virtual int get_num()
	{
		return num;
	}
};

class staple :public Food
{
public:
	virtual double get_sum()
	{
		double sum = price * num;
		return sum;
	}
};

class liangcai :public Food
{
public:
	virtual double get_sum()
	{
		double sum = price * num;
		return sum;
	}
};

class Drink :public Food
{
public:
	virtual double get_sum()
	{
		double sum = price * num;
		return sum;
	}
};

class Set :public Food
{
public:
	virtual double get_sum()
	{
		double sum = price * num;
		return sum;
	}
};

class Factory
{
public:
	virtual Food* food() = 0;
};

class Factory_staple :public Factory
{
public:
	Food* food()
	{
		return new staple;
	}
};

class Factory_liangcai :public Factory
{
public:
	Food* food()
	{
		return new liangcai;
	}
};

class Factory_Drink :public Factory
{
public:
	Food* food()
	{
		return new Drink;
	}
};

class Factory_Set :public Factory
{
public:
	Food* food()
	{
		return new Set;
	}
};

class xiaopiao
{
public:
	virtual void output() = 0;
};

class H1 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{
		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "黄焖鸡--" << num << "份" << endl;
			outfile << "黄焖鸡--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class H2 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "排骨炖玉米--" << num << "份" << endl;
			outfile << "排骨炖玉米--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class H3 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "青椒肉丝--" << num << "份" << endl;
			outfile << "青椒肉丝--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class S1 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "凉拌黄瓜--" << num << "份" << endl;
			outfile << "凉拌黄瓜--" << num << "份" << endl;
			outfile.close();
		}

	}
protected:
	int num;
};

class S2 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "猪耳朵--" << num << "份" << endl;
			outfile << "猪耳朵--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class D1 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "可口可乐--" << num << "份" << endl;
			outfile << "可口可乐--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class D2 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "七喜--" << num << "份" << endl;
			outfile << "七喜--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class D3 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "橙汁--" << num << "份" << endl;
			outfile << "橙汁--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class SET1 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "超值工作套餐--" << num << "份" << endl;
			outfile << "超值工作套餐--" << num << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};

class SET2 : public xiaopiao
{
public:
	void get_num(int n)
	{
		num = n;
	}
	void output()
	{

		if (0 != num)
		{
			ofstream outfile("receipt.dat", ios::out);
			cout << "情侣超值套餐--" << 1 << "份" << endl;
			outfile << "情侣超值套餐--" << 1 << "份" << endl;
			outfile.close();
		}
	}
protected:
	int num;
};
//运用策略模式简化 
class Context
{
public:
	Context(xiaopiao* p) : pStrategy(p)
	{
	}
	void Interface()
	{
		pStrategy->output();
	}
private:
	xiaopiao* pStrategy;
};


class collect
{
private:

public:
	void main_menu()
	{
		cout << "---------------------" << endl;
		cout << "欢迎进入酒店自助点餐系统！" << endl;
		cout << "---------------------" << endl;
		cout << "请问你选择单点(1)或者套餐(2)：" << endl;
	}
	void single_menu()
	{
		cout << "---------------------" << endl;
		cout << "请选择您要点的产品: " << endl;
		cout << "主食:  " << endl;
		cout << " 1.黄焖鸡  --20元 " << endl;
		cout << " 2.排骨炖玉米--20元 " << endl;
		cout << " 3.青椒肉丝--15元 " << endl;
		cout << "凉菜:  " << endl;
		cout << " 4.凉拌黄瓜 --10元 " << endl;
		cout << " 5.猪耳朵 --18元 " << endl;
		cout << "饮料:  " << endl;
		cout << " 6.可口可乐 --7元 " << endl;
		cout << " 7.七喜  --7元 " << endl;
		cout << " 8.橙汁  --10元 " << endl;
		cout << "若点餐结束，请输入0以结束点餐！" << endl;
	}
	void set_menu()
	{
		cout << "---------------------" << endl;
		cout << "请选择您要点的套餐: " << endl;
		cout << " 1.超值工作套餐 --28元" << endl;
		cout << " （包含两菜一汤外加饮料一瓶）" << endl;
		cout << " 2.情侣超值套餐 --48元" << endl;
		cout << " （包含四菜一汤外加饮料两瓶）" << endl;
		cout << "若点餐结束，请输入0以结束点餐！" << endl;
	}
	void menu()
	{
		main_menu();
		int choose;
		int staple[3], liangcai[2], drink[3], set[2];
		for (int i = 0; i < 3; i++) { staple[i] = 0; drink[i] = 0; }
		for (int i = 0; i < 2; i++) { liangcai[i] = 0; set[i] = 0; }
		cin >> choose;
		if (1 == choose)
		{
			single_menu();
			int ch, flag = 1;
			while (flag)
			{
				cout << "请输入对应商品的序号:";
				cin >> ch;
				switch (ch)
				{
				case(0):
				{
					flag = 0;
					break;
				}
				case(1):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					staple[0] = number;
					break;
				}
				case(2):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					staple[1] = number;
					break;
				}
				case(3):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					staple[2] = number;
					break;
				}
				case(4):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					liangcai[0] = number;
					break;
				}
				case(5):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					liangcai[1] = number;
					break;
				}
				case(6):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					drink[0] = number;
					break;
				}
				case(7):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					drink[1] = number;
					break;
				}
				case(8):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					drink[2] = number;
					break;
				}
				default:
				{
					cout << "请输入正确的序号！" << endl;
					break;
				}
				}
			}
		}
		else if (2 == choose)
		{
			set_menu();
			int ch, flag = 1;
			while (flag)
			{
				cout << "请输入对应商品的序号:";
				cin >> ch;
				switch (ch)
				{
				case(0):
				{
					flag = 0;
					break;
				}
				case(1):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					set[0] = number;
					break;
				}
				case(2):
				{
					cout << "请输入需要几份?:";
					int number;
					cin >> number;
					set[1] = number;
					break;
				}

				default:
				{
					cout << "请输入正确的序号！" << endl;
					break;
				}
				}
			}
		}
		//生成主食工厂类
		Factory_staple* fac_h = new Factory_staple();
		//生成具体的主食类
		Food* staple1 = fac_h->food();
		Food* staple2 = fac_h->food();
		Food* staple3 = fac_h->food();
		//实例化各个主食 
		//黄焖鸡 
		staple1->set_name("黄焖鸡");
		staple1->set_price(20);
		staple1->set_num(staple[0]);
		//排骨炖玉米 
		staple2->set_name("排骨炖玉米");
		staple2->set_price(20);
		staple2->set_num(staple[1]);
		//青椒肉丝 
		staple3->set_name("青椒肉丝");
		staple3->set_price(15);
		staple3->set_num(staple[2]);

		//生成凉菜工厂类
		Factory_liangcai* fac_s = new Factory_liangcai();
		//生成具体的凉菜类
		Food* liangcai1 = fac_s->food();
		Food* liangcai2 = fac_s->food();
		//实例化各个凉菜 
		//凉拌黄瓜 
		liangcai1->set_name("凉拌黄瓜");
		liangcai1->set_price(10);
		liangcai1->set_num(liangcai[0]);
		//猪耳朵 
		liangcai2->set_name("猪耳朵");
		liangcai2->set_price(18);
		liangcai2->set_num(liangcai[1]);

		//生成饮料工厂类
		Factory_Drink* fac_d = new Factory_Drink();
		//生成具体的饮料类
		Food* drink1 = fac_d->food();
		Food* drink2 = fac_d->food();
		Food* drink3 = fac_d->food();
		//实例化各个饮料
		//可口可乐
		drink1->set_name("可口可乐");
		drink1->set_price(7);
		drink1->set_num(drink[0]);
		//七喜
		drink2->set_name("七喜");
		drink2->set_price(7);
		drink2->set_num(drink[1]);
		//橙汁 
		drink3->set_name("橙汁");
		drink3->set_price(7);
		drink3->set_num(drink[2]);

		//生成套餐工厂类
		Factory_Set* fac_se = new Factory_Set();
		//生成具体的套餐类
		Food* set1 = fac_se->food();
		Food* set2 = fac_se->food();
		//实例化各个套餐
		//超值工作套餐
		set1->set_name("超值工作套餐");
		set1->set_price(28);
		set1->set_num(set[0]);
		//情侣超值套餐
		set2->set_name("情侣超值套餐");
		set2->set_price(48);
		set2->set_num(set[1]);

		//找零部分
		cout << "---------------------" << endl;
		double sum = 0;
		sum = sum + staple1->get_sum();
		sum = sum + staple2->get_sum();
		sum = sum + staple3->get_sum();
		sum = sum + liangcai1->get_sum();
		sum = sum + liangcai2->get_sum();
		sum = sum + drink1->get_sum();
		sum = sum + drink2->get_sum();
		sum = sum + drink3->get_sum();
		sum = sum + set1->get_sum();
		sum = sum + set2->get_sum();
		cout << "您共计消费:" << sum << endl;
		cout << "请问您是否使用优惠券？(输入0已接受)";
		int ch;
		cin >> ch;
		int yhq = 0;
		if (0 == ch)
		{
			cout << "您拥有如下优惠券:" << endl;
			cout << "-1.满50减5" << endl;
			cout << "-2.满100减15" << endl;
			cout << "-3.满200减40" << endl;
			cout << "每次消费仅能使用一张优惠券,请选择使用的优惠券" << endl;
			int flag = 1;
			while (flag)
			{
				int ch;
				cin >> ch;
				if (ch == 1)
				{
					if (sum > 50) { sum -= 5; cout << "使用消费券成功!"; }
					else { cout << "您的消费金额还不能使用优惠券！" << endl; }
					flag = 0;
				}
				if (ch == 2)
				{
					if (sum > 100) { sum -= 15; cout << "使用消费券成功!"; }
					else { cout << "您的消费金额还不能使用优惠券！" << endl; }
					flag = 0;
				}
				if (ch == 3)
				{
					if (sum > 200) { sum -= 40; cout << "使用消费券成功!"; }
					else { cout << "您的消费金额还不能使用优惠券！" << endl; }
					flag = 0;
				}
				if (ch == 0)
				{
					cout << "不使用优惠券" << endl;
					flag = 0;
				}
			}
		}
		cout << "请问您支付多少:";
		double pay;
		cin >> pay;
		double payback = pay - sum;
		while (0 > payback)
		{
			cout << "您好，您的钱不够本次消费(微笑.jpg),请重给，谢谢您哦~";
			cin >> pay;
			payback = pay - sum;
		}
		cout << "共计收您" << pay << "元。" << endl;
		cout << "找零为:" << payback << "元" << endl;
		int cho;
		cout << "---------------------" << endl;
		cout << "请选择是否打印小票:(输入0以打印)" << endl;
		cin >> cho;
		if (0 == cho)
		{

			ofstream outfile("receipt.dat", ios::out);
			cout << "---------------------" << endl;
			outfile << "---------------------" << endl;
			cout << "欢迎来到酒店欢乐餐厅！" << endl;
			outfile << "欢迎来到酒店欢乐餐厅！" << endl;
			cout << "您共计点餐:" << endl;
			outfile << "您共计点餐:" << endl;
			cout << endl;
			outfile << endl;
			H1* h1 = new H1;
			h1->get_num(staple[0]);
			H2* h2 = new H2;
			h2->get_num(staple[1]);
			H3* h3 = new H3;
			h3->get_num(staple[2]);
			S1* s1 = new S1;
			s1->get_num(liangcai[0]);
			S2* s2 = new S2;
			s2->get_num(liangcai[1]);
			D1* d1 = new D1;
			d1->get_num(drink[0]);
			D2* d2 = new D2;
			d2->get_num(drink[1]);
			D3* d3 = new D3;
			d3->get_num(drink[2]);
			SET1* set1 = new SET1;
			set1->get_num(set[0]);
			SET2* set2 = new SET2;
			set2->get_num(set[1]);
			Context* ph1 = new Context(h1);
			Context* ph2 = new Context(h2);
			Context* ph3 = new Context(h3);
			Context* ps1 = new Context(s1);
			Context* ps2 = new Context(s1);
			Context* pd1 = new Context(d1);
			Context* pd2 = new Context(d2);
			Context* pd3 = new Context(d3);
			Context* pset1 = new Context(set1);
			Context* pset2 = new Context(set2);
			ph1->Interface();
			ph2->Interface();
			ph3->Interface();
			ps1->Interface();
			ps2->Interface();
			pd1->Interface();
			pd2->Interface();
			pd3->Interface();
			pset1->Interface();
			pset2->Interface();
			cout << endl;
			outfile << endl;
			cout << "---------------------" << endl;
			outfile << "---------------------" << endl;
			cout << "---------------------" << endl;
			outfile << "---------------------" << endl;
			cout << endl;
			outfile << endl;
			cout << "共计收您" << pay << "元。" << endl;
			outfile << "共计收您" << pay << "元。" << endl;
			cout << "找零为:" << payback << "元" << endl;
			outfile << "找零为:" << payback << "元" << endl;
			outfile.close();
			//运用策略模式简化上列大量if语句
		}

	}
};


int main()
{
	collect c;
	c.menu();

}
